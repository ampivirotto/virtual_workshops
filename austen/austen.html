<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Tutorials: Jane Austen Text Analysis</title>

  <!-- Load Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.3/full/pyodide.js"></script>

  <!-- Your existing stylesheet -->
  <link rel="stylesheet" href="../style.css">
  <style>
    /* Minimal backup styling */
    section { margin-bottom: 2rem; }
    .exercise { background: #f9f9f9; padding: 1rem; border-radius: 10px; margin-top: 1rem; }
    button { background-color: #0077cc; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; }
    button:hover { background-color: #005fa3; }
    pre { background: #f0f0f0; padding: 0.5rem; border-radius: 6px; overflow-x: auto; }
    .output { background: #fff; border: 1px solid #ddd; padding: 0.5rem; border-radius: 6px; white-space: pre-wrap; margin-top: 0.5rem; }
  </style>
</head>

<body>

<header>
  <h1>Data Tutorials</h1>
  <p>Interactive Python Tutorial: Jane Austen Text Analysis</p>
  <a class="home-button" href="../index.html">üè† Back to Tutorials Home</a>
</header>

<main>

  <section class="intro-box">
    <h2>Analyzing Jane Austen's Novels</h2>
    <p>In honor of Jane Austen's 250th birthday we will be using her novels to begin to explore text analysis. You'll learn how to analyze the text of Jane Austen's novels using Python. We'll cover text collection, sentiment analysis, and some basic visualization techniques.</p>
    <img src="hbd_jane.png" alt="Jane Austen with the words Happy Birthday Jane superimposed" style="max-width:100%; border-radius:10px; margin-top:1rem; margin:auto; display:block;">
  </section>

  <!-- Section 1 -->
  <section>
    <h2>Step 1: Collecting Texts from Project Gutenberg</h2>
    <p>In this section, you will learn how to pull Jane Austen novels from <a href="https://www.gutenberg.org/" target="_blank">Project Gutenberg</a> for analysis. The full version (available in Colab) includes all necessary code and explanations to download the text directly from Project Gutenberg.</p>

    <a class="colab-button" href="https://colab.research.google.com/github/ampivirotto/virtual_workshops/blob/main/austen/austen_exercise.ipynb" target="_blank">
      Launch Full Notebook in Colab
    </a>
    <p> In the cell below, we give an example of how you might define the list of Jane Austen's novels by title or ID number. This can then be used to download several different texts from Project Gutenberg at once. However, for this example we start with a single book "Pride and Prejudice" and we show how you can use the <a href="https://requests.readthedocs.io/en/latest/" target="_blank">requests</a> package to download the text. </p>
    <pre><code>jane_austen_book_titles = ["Pride and Prejudice", "Sense and Sensibility", "Emma"] ## Option 1: by title
jane_austen_book_ids = [1342, 161, 158]  ## Option 2: by Gutenberg ID number

## let's start with downloading one book as an example
book_id = jane_austen_book_ids[0]  # Pride and Prejudice

import requests ## to make HTTP requests
book_url = f"https://www.gutenberg.org/cache/epub/{book_id}/pg{book_id}.txt"

response = requests.get(book_url) ## this makes the call to the website to download the text
if response.status_code == 200: # check if the request was successful
    book_text = response.text
    print(f"Successfully downloaded book ID {book_id}")
else:
    print(f"Failed to download book ID {book_id}")
</code></pre>

<p> Notice how we downloaded the text file by making an HTTP GET request to the Gutenberg website. The text is then stored in the `book_text` variable for further analysis. We can do a quick sanity check to make sure we're downloading the correct file by following the link we created: <a href="https://www.gutenberg.org/cache/epub/1342/pg1342.txt" target="_blank">https://www.gutenberg.org/cache/epub/1342/pg1342.txt</a>.</p>
  </section>

  <section>
    <h2>Step 2: Sentiment Analysis</h2>
    <p> Now that we have the text of a single book "Pride and Prejudice" grabbed, we can perform some basic sentiment analysis. What is sentiment analysis? <a href="http://geeksforgeeks.org/machine-learning/what-is-sentiment-analysis/" target="_blank"> Using natural language processing (NLP) we can analyze the emotions expressed in a text.</a> Here are three different approaches we can take to better understand the text. Each exercise is fully developed in the Colab notebook linked above, but these code snippets give you a starting point.</p>

    <div class="exercise">
      <h3>Exercise: Count Words in a Sample Text</h3>
      <p>One thing you might want to understand about your text is how often each word appears. We can do this by counting the occurrences of each word.</p>
      <pre><code>import re

## Here we give a small sample text
sample_text = "Pride and Prejudice is a novel by Jane Austen. It is full of wit and social commentary."

words = re.findall(r'\b\w+\b', sample_text.lower()) ## this regex finds all words and makes them lowercase

print("Words:", words)
print("Total words:", len(words))</code></pre>
      <button onclick="runPython('exercise1', this.previousElementSibling)">Run Code</button>
      <div id="exercise1" class="output"></div>
    </div>

    <div class="exercise">
      <h3>Exercise: Filter Stopwords</h3>
      <p>You might notice that in the sentence above "is" occurs twice, but doesn't affect the overall meaning. Can you imagine other words that appear often but don't have significant affect on the meaning of the text? Stopwords are common words that may not carry significant meaning in text analysis. We can filter these out to focus on more meaningful words.</p>
      <pre><code>stop_words = {"and", "is", "a", "it", "of"} ## a small set of common stopwords

filtered_words = [] ## empty list to hold words that are not stopwords
for word in words: ## loop through all words to filter out stopwords
    if word not in stop_words: ## check if word is not a stopword
        filtered_words.append(word) ## add to filtered list

print("Filtered words:", filtered_words)</code></pre>
      <button onclick="runPython('exercise2', this.previousElementSibling)">Run Code</button>
      <div id="exercise2" class="output"></div>
    </div>

    <div class="exercise">
      <h3>Exercise: Compute Average Sentiment</h3>
      <p> In the actual Colab notebook, we would calculate the sentiment scores using a library like <a href="https://www.nltk.org/" target="_blank">NLTK</a>. For this sample code though, we will use dummy data sentiment scores.</p>
      <pre><code>## series of fabricated sentiment scores for a series of sentences
sentiment_scores = [0.1, 0.3, 0.2, -0.1, 0.0, 0.2, 0.1, -0.2, 0.0, 0.1]

avg_sentiment = sum(sentiment_scores) / len(sentiment_scores) ## calculate average sentiment

print("Average sentiment:", avg_sentiment)</code></pre>
      <button onclick="runPython('exercise3', this.previousElementSibling)">Run Code</button>
      <div id="exercise3" class="output"></div>
    </div>

  </section>

  <!-- Section 3 -->
  <section>
    <h2>Step 3: Visualizing Sentiment Trajectories</h2>
    <p>Here is a small interactive demo of sentiment trajectories using preloaded data. This demo visualizes sample data, but in the full notebook, we would use real sentiment analysis results.</p>

    <div class="exercise">
      <pre><code>import pandas as pd ## for data table manipulation
import matplotlib.pyplot as plt ## for plotting

data = {
    "Book": ["Pride and Prejudice"]*5 + ["Emma"]*5,
    "Segment": [1,2,3,4,5]*2,
    "Sentiment": [0.1,0.3,0.2,-0.1,0.0, 0.2,0.1,-0.2,0.0,0.1]
} ## sample data representing sentiment scores across segments of two books

df = pd.DataFrame(data) ## create a DataFrame from the sample data
fig, ax = plt.subplots(figsize=(6,4)) ## create a plot
for book, subset in df.groupby("Book"):
    ax.plot(subset["Segment"], subset["Sentiment"], marker='o', label=book) ## plot sentiment trajectories for each book

## Add titles and labels
ax.set_title("Sentiment Trajectories Across Austen Novels") 
ax.set_xlabel("Segment")
ax.set_ylabel("Sentiment Score")
ax.axhline(0, color='gray', linestyle='--')
ax.legend()
plt.show()</code></pre>
      <button onclick="runPython('exercise4', this.previousElementSibling)">Run Code</button>
      <div id="exercise4" class="output"></div>
    </div>

  </section>

</main>

<footer>
  Created by <a href="https://github.com/ampivirotto" target="_blank">Alyssa Pivirotto</a>
</footer>

<script>
  // Initialize Pyodide and preload key packages
  const pyodideReadyPromise = (async () => {
    const pyodide = await loadPyodide({
      indexURL: "https://cdn.jsdelivr.net/pyodide/v0.26.3/full/",
    });
    await pyodide.loadPackage(["pandas", "matplotlib"]);
    return pyodide;
  })();

  async function runPython(outputId) {
    const code = event.target.previousElementSibling.textContent.trim();
    const outputDiv = document.getElementById(outputId);
    outputDiv.textContent = "Running...";
    const pyodide = await pyodideReadyPromise;

    try {
      // Redirect Python stdout to StringIO
      await pyodide.runPythonAsync(`
import sys
from io import StringIO
sys.stdout = StringIO()
`);

      // Execute the user's code
      await pyodide.runPythonAsync(code);

      // Get text output
      const printed = pyodide.runPython("sys.stdout.getvalue()");

      // Handle plots (if any)
      const figExists = pyodide.runPython(`
import matplotlib.pyplot as plt
len(plt.get_fignums()) > 0
`);
      if (figExists) {
        const imageData = pyodide.runPython(`
import base64, io
buf = io.BytesIO()
plt.savefig(buf, format='png', bbox_inches='tight')
plt.close()
base64.b64encode(buf.getvalue()).decode('utf-8')
`);
        outputDiv.innerHTML = "<pre>" + printed + "</pre>";
        const img = document.createElement("img");
        img.src = "data:image/png;base64," + imageData;
        img.style.display = "block";
        img.style.marginTop = "10px";
        img.style.maxWidth = "100%";
        outputDiv.appendChild(img);
      } else {
        outputDiv.textContent = printed.trim() || "Done!";
      }
    } catch (err) {
      outputDiv.textContent = "Error: " + err;
    }
  }
</script>





</body>
</html>
